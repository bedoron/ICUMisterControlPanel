{% extends "base.html" %}
{% block title %}Detected strangers{% endblock %}
{% block head %}
{{ super() }}
{% endblock %}
{% block content %}
<h1>Detected strangers</h1>
<table class="table table-striped">
    <thead>
    <tr>
        <th>Face image</th>
        <th>Date</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    {% for user in pending_users %}
    <tr>
        <td><img src="{{ user.img_url }}" alt="{{ user.id }}"/></td>
        <td><span>{{ user.ts }}  <span class="badge badge-secondary">{{user.status}}</span></span></td>
        <td>
            <div align="center">
                <a href="{{ user.train_known }}#known" class="btn btn-default">Add</a>
                <a href="{{ user.train_ignore }}#ignore" class="btn btn-default">Ignore</a>
                <a href="{{ user.delete_face_url }}#delete" class="btn btn-default">Delete</a>
                <a href="{{ url_for('is_face_known', object_id=user.id) }}" class="btn btn-default rest">is known</a>
                <a href="{{ url_for('is_face_unknown', object_id=user.id) }}" class="btn btn-default rest">is unknown</a>
                <a href="{{ url_for('is_face_ignored', object_id=user.id) }}" class="btn btn-default rest">is ignored</a>
                <a href="{{ user.info_url }}" class="btn btn-default log">info</a>
            </div>
        </td>
    </tr>
    {% endfor %}
</table>
<p class="navbar-btn">
    <a href="{{ url_for('add_face') }}" class="btn btn-default">Add face</a>
    <a href="{{ url_for('reset_training') }}" class="btn btn-default">Reset training</a>
</p>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Person DB Object</h4>
      </div>
      <div class="modal-body">
        <pre id="modalcontainer"></pre>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

<script type="text/javascript">

$("a[class~='log'").click(function(evt) {
    evt.preventDefault();
    target = evt.target;
    $.getJSON(this.href, function(data) {
        debugger;
        console.log(data);
        $("#modalcontainer").text(JSON.stringify(data, null, 2));
        $("#myModal").modal("show");
    });
});

$("a[class~='rest']").click(function(evt) {
    evt.preventDefault();
    target = evt.target;
    $.getJSON(this.href, function(data) {
        messageType = "btn-danger";
        if (data['result']) {
            messageType = "btn-success";
        }
        $(target).addClass(messageType);
        return false;
    });
});


</script>
{% endblock %}